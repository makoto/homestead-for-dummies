<html>
<head>
  <title>JavaScript API</title>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js">
  <script src="bower_components/web3/dist/web3.min.js"></script>
  <script type="text/javascript">
    var Web3 = require('web3');
    var web3 = new Web3();

    // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3setprovider
    web3.setProvider(new web3.providers.HttpProvider('http://localhost:8545'));

    //// Compiled me.sol via https://chriseth.github.io/browser-solidity/?gist=b2c494702c400265db9668fe5014cdf2
    // var meContract = web3.eth.contract([{"constant":false,"inputs":[],"name":"getFirst","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"myAddress","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"first","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"last","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":false,"inputs":[],"name":"getLast","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"nick","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"twitter","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"dateJoined","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"}]);
    // var me = meContract.new(
    //    {
    //      from: web3.eth.accounts[0],
    //      data: '60606040525b604060405190810160405280600381526020017f4b656e000000000000000000000000000000000000000000000000000000000081526020015060006000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061008d57805160ff19168380011785556100be565b828001600101855582156100be579182015b828111156100bd57825182600050559160200191906001019061009f565b5b5090506100e991906100cb565b808211156100e557600081815060009055506001016100cb565b5090565b5050604060405190810160405280600781526020017f4b6170706c65720000000000000000000000000000000000000000000000000081526020015060016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061017357805160ff19168380011785556101a4565b828001600101855582156101a4579182015b828111156101a3578251826000505591602001919060010190610185565b5b5090506101cf91906101b1565b808211156101cb57600081815060009055506001016101b1565b5090565b5050604060405190810160405280600b81526020017f406b6170706c65726b656e00000000000000000000000000000000000000000081526020015060026000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061025957805160ff191683800117855561028a565b8280016001018555821561028a579182015b8281111561028957825182600050559160200191906001019061026b565b5b5090506102b59190610297565b808211156102b15760008181506000905550600101610297565b5090565b5050604060405190810160405280600981526020017f426c7565436861696e000000000000000000000000000000000000000000000081526020015060036000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061033f57805160ff1916838001178555610370565b82800160010185558215610370579182015b8281111561036f578251826000505591602001919060010190610351565b5b50905061039b919061037d565b80821115610397576000818150600090555060010161037d565b5090565b505033600460006101000a81548173ffffffffffffffffffffffffffffffffffffffff02191690830217905550426005600050819055505b6107f5806103e16000396000f36060604052361561008a576000357c0100000000000000000000000000000000000000000000000000000000900480631e2231431461008c57806326b85ee1146101075780633df4ddf41461014057806347799da8146101bb5780634d622831146102365780637d4fcb1f146102b1578063abfaeee01461032c578063e5209145146103a75761008a565b005b610099600480505061067d565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156100f95780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610114600480505061064e565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b61014d60048050506103ca565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156101ad5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101c8600480505061046b565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156102285780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6102436004805050610739565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156102a35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6102be60048050506105ad565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f16801561031e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b610339600480505061050c565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156103995780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6103b46004805050610674565b6040518082815260200191505060405180910390f35b60006000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104635780601f1061043857610100808354040283529160200191610463565b820191906000526020600020905b81548152906001019060200180831161044657829003601f168201915b505050505081565b60016000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105045780601f106104d957610100808354040283529160200191610504565b820191906000526020600020905b8154815290600101906020018083116104e757829003601f168201915b505050505081565b60026000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105a55780601f1061057a576101008083540402835291602001916105a5565b820191906000526020600020905b81548152906001019060200180831161058857829003601f168201915b505050505081565b60036000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106465780601f1061061b57610100808354040283529160200191610646565b820191906000526020600020905b81548152906001019060200180831161062957829003601f168201915b505050505081565b600460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60056000505481565b602060405190810160405280600081526020015060006000508054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561072a5780601f106106ff5761010080835404028352916020019161072a565b820191906000526020600020905b81548152906001019060200180831161070d57829003601f168201915b50505050509050610736565b90565b602060405190810160405280600081526020015060016000508054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156107e65780601f106107bb576101008083540402835291602001916107e6565b820191906000526020600020905b8154815290600101906020018083116107c957829003601f168201915b505050505090506107f2565b9056',
    //      gas: 3000000
    //    }, function(e, contract){
    //     console.log(e, contract);
    //     if (typeof contract.address != 'undefined') {
    //          window.myContract = contract;
    //          console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
    //     }
    //  })
    //
    var contractAddress = "0x673380d0c63ff4dfdae9183d58208276c87741d1";
    var abiArray = [{"constant":false,"inputs":[],"name":"getFirst","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"myAddress","outputs":[{"name":"","type":"address"}],"type":"function"},{"constant":true,"inputs":[],"name":"first","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"last","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":false,"inputs":[],"name":"getLast","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"nick","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"twitter","outputs":[{"name":"","type":"string"}],"type":"function"},{"constant":true,"inputs":[],"name":"dateJoined","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[],"type":"constructor"}]

    // Instantiating contract based on contract address and interface
    // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethcontract
    var MyContract = web3.eth.contract(abiArray);
    var contractInstance = MyContract.at(contractAddress);

    // Accessing the base address and its account balance
    // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethcoinbase
    var coinbase = web3.eth.coinbase;
    // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethgetbalance
    var balance = web3.eth.getBalance(coinbase);

    // Accessing storage of the contract
    // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethgetstorageat
    var storageObject = web3.eth.getStorageAt(contractAddress);
    var firstName = web3.toAscii(web3.eth.getStorageAt(contractAddress, 0))
    var lastName = web3.toAscii(web3.eth.getStorageAt(contractAddress, 1))
    var contractString = JSON.stringify(web3.eth.getStorageAt(contractAddress))

    document.addEventListener('DOMContentLoaded', function() {
      // Showing your account and its balance
      document.getElementById('coinbase').innerText = coinbase;
      document.getElementById('balance').innerText = balance;

      // Showing contract string and its data
      document.getElementById('contractString').innerText = contractString;
      document.getElementById('fullName').innerText = firstName + ' ' + lastName;

      // Accessing public variables of the contract
      document.getElementById('fullName2').innerText = contractInstance.first() + ' ' + contractInstance.last();
    });


    // Watching any newly added block to the network.
    // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethfilter
    var pending = web3.eth.filter('pending');
    pending.watch(function(error, result){
      if(error) return;

      // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethblocknumber
      var blockNumber = web3.eth.blockNumber;
      // https://github.com/ethereum/wiki/wiki/JavaScript-API#web3ethgetblock
      var block = web3.eth.getBlock(blockNumber);

      // Showing the latest block added to the network.
      document.getElementById('latestBlock').innerText = blockNumber;
      document.getElementById('latestBlockHash').innerText = block.hash;
      document.getElementById('latestBlockTimestamp').innerText = Date(block.timestamp);
    });
  </script>

</head>

<body>

  <div class="header">
    <h3>JavaScript API</h3>
  </div>

  <div class="jumbotron">
    <h5>Coinbase Address: <strong id="coinbase"></strong></h5>
    <h5>Balance: <strong id="balance"></strong></h5>
    <h5>Latest Block Number: <strong id="latestBlock"></strong></h5>
    <h5>Latest Block Timestamp: <strong id="latestBlockTimestamp"></strong></h5>
    <h5>Latest Block Hash: <strong id="latestBlockHash"></strong></h5>
    <h5>Contract String: <strong id="contractString"></strong></h5>
    <h5>Full Name: <strong id="fullName"></strong></h5>
    <h5>Full Name2: <strong id="fullName2"></strong></h5>
    <br>
  </div>

</body>

</html>
